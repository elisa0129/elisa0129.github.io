/* ===== 基礎：單色背景、900px 置中 ===== */
:root{
  --page-bg:#05080f;
  --muted:#7d7d7d;
  --card-shadow:0 16px 44px rgba(0,0,0,.48);
  --focus-mask: rgba(0,0,0,0.45); /* Focus 遮罩透明度 */
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial;
  background:var(--page-bg);
  color:#e9eef6;
  line-height:1.6;
  padding:2rem;
}
.site-header,.site-footer,main{max-width:900px;margin:0 auto}
.site-header{margin-bottom:2rem}
.site-header h1{margin:0 0 .25rem;font-size:2rem}
.lead{color:var(--muted)}
main{max-width:900px;margin:0 auto}

/* ===== 卡片分段 ===== */
.content-section{
  position:relative;
  border-radius:12px;
  padding:2rem;
  margin:2.4rem 0;
  background:#182540;               /* 單一卡片底色，避免背景疊色 */
  box-shadow:var(--card-shadow);
}

/* 標題徽章（沿用你原感覺） */
.section-header{display:flex;align-items:center;gap:12px;margin:0 0 .6rem}
.section-badge{
  display:inline-block;font-size:.78rem;font-weight:700;letter-spacing:.4px;
  padding:6px 10px;border-radius:999px;color:#04102a;
  background:linear-gradient(90deg,#9be9ff,#d9b8ff);
  border:1px solid rgba(255,255,255,0.14);
  box-shadow:0 8px 22px rgba(10,8,20,0.45);
}

/* ===== 1) Focus mode（純 CSS scroll-driven） ===== */
/* 第一段設為 view timeline 來源 */
.focus-target{
  view-timeline-name: --focus;
  view-timeline-axis: block;
}

/* 疊層：提早開始（cover 75%）到 exit 100% 變暗 */
.focus-target::after{
    mix-blend-mode: normal; 
  content:"";
  position:absolute;inset:0;border-radius:inherit;
  background:var(--focus-mask);
  opacity:0;
  pointer-events:none;
  animation: focusDim 1 both;
  animation-timeline: --focus;
  /* ★ 原 85% → 調成 75%：更早開始暗 */
  animation-range: cover 75% exit 100%;
}
/* 同步輕微降亮 */
.focus-target{
  animation: focusFilter 1 both;
  animation-timeline: --focus;
  animation-range: cover 75% exit 100%;
}
@keyframes focusDim{ from{opacity:0} to{opacity:1} }
@keyframes focusFilter{ 
  from { filter: brightness(1) saturate(1); } 
  to   { filter: brightness(0.6) saturate(0.8); }  /* ← 更暗、更對比 */
}


/* 你的裝飾風格（保留） */
.focus-strong{
  background: linear-gradient(180deg, rgba(250,250,255,0.2), rgba(240,245,255,0.1));
  border: 1px solid rgba(210,200,255,0.6);
}
.focus-strong::before{
  content:'';
  position:absolute; left:12px; top:16px; bottom:16px; width:6px; border-radius:6px;
  background: linear-gradient(180deg,#6fe8ff,#9b3cff);
  box-shadow: 0 10px 24px rgba(107,232,255,0.12);
  pointer-events:none;
}

/* ===== 2) Flip card（純 CSS；前後兩面各自旋轉） ===== */
.card-section{display:flex;flex-direction:column;gap:1rem}
.flip-card{
  width:100%;max-width:700px;height:350px;margin:0 auto;perspective:1200px;
  /* 讓卡片也有自己的 timeline */
  view-timeline-name: --card;
  view-timeline-axis: block;
}
.card-inner{
  width:100%;height:100%;position:relative;transform-style:preserve-3d;
  border-radius:12px;box-shadow:0 10px 30px rgba(2,6,23,0.6);overflow:hidden;
}
.card-face{
  position:absolute;inset:0;backface-visibility:hidden;
  display:flex;align-items:center;justify-content:center;flex-direction:column;
  color:#031027;
}
/* 初始：顯示前面、背面朝內 */
.card-front{transform:rotateY(0deg);background:linear-gradient(180deg,#ffffff,#f6f8ff);padding:1.2rem; z-index:2}
.card-back {transform:rotateY(180deg);background:linear-gradient(180deg,#fff,#f6f6f8);padding:1.4rem;text-align:left; z-index:1}
.card-back .back-content{ color:#071428; }

/* 使用同一條 timeline 在靠近中線時切換前後面（45%→55%） */
.card-front{
  animation: frontFlipOut 1 both;
  animation-timeline: --card;
  animation-range: cover 45% cover 55%;
}
.card-back{
  animation: backFlipIn 1 both;
  animation-timeline: --card;
  animation-range: cover 45% cover 55%;
}
/* 前面：0 → -180，同步把透明度淡出、把層級放低 */
@keyframes frontFlipOut{
  0%   { transform:rotateY(0deg);   opacity:1; z-index:2; }
  49%  { opacity:0.02; z-index:2; }
  50%  { transform:rotateY(-90deg); opacity:0; z-index:1; }
  100% { transform:rotateY(-180deg); opacity:0; z-index:1; }
}
/* 後面：180 → 0，同步把透明度淡入、層級墊高（確保看得到文字） */
@keyframes backFlipIn{
  0%   { transform:rotateY(180deg); opacity:0; z-index:1; }
  50%  { transform:rotateY(90deg);  opacity:0.02; z-index:2; }
  100% { transform:rotateY(0deg);   opacity:1; z-index:2; }
}
.hint{color:var(--muted);font-size:.95rem}

/* ===== 3) Lyrics underline（純 CSS） ===== */
.lyrics-box{
  background: rgba(255,255,255,0.06);
  border-radius:8px;
  padding:1rem 1.2rem;
  margin-top:0.6rem;
  box-shadow: 0 8px 20px rgba(2,6,23,0.45);
  border: 1px solid rgba(255,255,255,0.08);
}
.lyrics-box p{ margin:0.6rem 0; color:#e9eef6; font-size:1rem }

.underline-trigger{
  position: relative;
  display: inline-block;
  padding: 0 .18rem;
  vertical-align: baseline;
  view-timeline-name: --u;
  view-timeline-axis: block;
}
.underline-trigger::after{
  content: '';
  position: absolute;
  left: 0;
  bottom: -6px;
  height: 4px;
  width: 100%;
  background: linear-gradient(90deg,#ffdfe8,#ff7a7a);
  border-radius: 3px;
  transform-origin: left center;
  transform: scaleX(0);
  will-change: transform;

  /* 進場前半段畫線：entry 0% → cover 60% */
  animation: drawUnderline 1 both;
  animation-timeline: --u;
  animation-range: entry 0% cover 60%;
}
@keyframes drawUnderline{ from{ transform: scaleX(0) } to{ transform: scaleX(1) } }

/* footer */
.site-footer{margin-top:3rem;color:var(--muted);text-align:center;font-size:.9rem}

/* 響應式 */
@media (max-width:600px){
  body{padding:1rem}
  .site-header h1{font-size:1.4rem}
}

/* 無支援 scroll-driven 時的退場處理 */
@supports not (animation-timeline: view()){
  .focus-target::after{ display:none }
  .card-front,.card-back{ transform:none; opacity:1 }
}
